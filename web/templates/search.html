{{define "content"}}
<div class="search-interface">
    <form action="/search" method="POST" class="search-form">
        <div class="search-fields">
            <div class="form-group">
                <label for="type">Type</label>
                <select id="type" name="type">
                    <option value="">Any</option>
                    <option value="note">Note</option>
                    <option value="file">File</option>
                </select>
            </div>

            <div class="form-group">
                <label for="tags">Tags</label>
                <input type="text" id="tags" name="tags" placeholder="tag1, tag2">
            </div>

            <div class="form-group">
                <label for="title">Title</label>
                <input type="text" id="title" name="title" placeholder="Search by title">
            </div>

            <button type="submit" class="button">Search</button>
        </div>
    </form>

    {{if .Results}}
    <div class="search-results">
        <h2>Results</h2>
        <div class="results-grid">
            {{range .Results}}
            <div class="result-card">
                <div class="result-header">
                    <h3>
                        {{if .Meta.title}}
                            {{.Meta.title}}
                        {{else}}
                            {{.ID | printf "%.8s"}}
                        {{end}}
                    </h3>
                    <span class="result-type">{{.Type}}</span>
                </div>
                <div class="result-meta">
                    {{if .Meta.tags}}
                    <div class="tags">
                        {{range .Meta.tags}}
                        <span class="tag">{{.}}</span>
                        {{end}}
                    </div>
                    {{end}}
                    <time>{{.Modified.Format "Jan 02, 2006 15:04"}}</time>
                </div>
                <div class="result-preview">
                    {{if eq .Type "note"}}
                        {{printf "%.200s" .Content}}...
                    {{else if eq .Type "file"}}
                        {{.Meta.filename}}
                    {{end}}
                </div>
                <div class="result-actions">
                    <a href="/show/{{.ID}}" class="button">View</a>
                    <a href="/link?source={{.ID}}" class="button">Link</a>
                </div>
            </div>
            {{end}}
        </div>
    </div>
    {{else if .Query}}
    <div class="no-results">
        <p>No results found for your search.</p>
    </div>
    {{end}}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.search-form');
    const tagsInput = document.getElementById('tags');

    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const query = {};
        
        // Get type
        const type = document.getElementById('type').value;
        if (type) query.type = type;

        // Get tags
        const tags = tagsInput.value.split(',')
            .map(tag => tag.trim())
            .filter(tag => tag.length > 0);
        if (tags.length > 0) query.tags = tags;

        // Get title
        const title = document.getElementById('title').value;
        if (title) query.title = title;

        // Submit as JSON
        fetch('/api/search', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(query)
        })
        .then(response => response.json())
        .then(data => {
            // Redirect to results page
            const params = new URLSearchParams(query);
            window.location.href = '/search?' + params.toString();
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error performing search');
        });
    });
});
</script>
{{end}}
